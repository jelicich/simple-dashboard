var marfeel={};marfeel.ChartModel={getDevicesData:function(t){var e=[{statName:"Revenue",value:2e5,history:[1,2,8,12,10,12,13,14,13,16,17,15,16,12,16,17,15,16,11],details:[{deviceName:"Smartphone",value:8e4},{deviceName:"Tablet",value:12e4}]},{statName:"Impressions",value:5e7,history:[1,2,8,12,10,12,13,14,13,16,17,15,16,12,16,17,15,16,16,15,14,17,16,12,13,14,13,16,17,15,16,12,16,17,15,16,11],details:[{deviceName:"Smartphone",value:3e7},{deviceName:"Tablet",value:2e7}]},{statName:"Visits",value:6e8,history:[1,2,8,12,10,12,13,14,13,16,17,15,16,12,16,17,15,16,11],details:[{deviceName:"Smartphone",value:12e7},{deviceName:"Tablet",value:48e7}]}];t(e)}},marfeel.ChartController={init:function(){var t=this;marfeel.ChartModel.getDevicesData(function(e){for(var a={Revenue:["#55d321","#006400"],Impressions:["#09c5df","#004f65"],Visits:["#d55710","#fdc308"]},r=0;r<e.length;r++){var n=e.statName,i=(a[n],e[r]);t.generateMiniDashboard("chart-container",i,a)}}),console.log("init chartcontroller")},generateMiniDashboard:function(t,e,a){var r=document.getElementById(t),n=document.createElement("div");n.setAttribute("class","chart-wrapper"),r.appendChild(n);var i=n.offsetWidth,l=n.offsetHeight,s=.05*n.offsetHeight,d=Math.min(i,l)/3,o=d-.07*d,c=d-.14*d,u=.14*d-.07*d,p=a[e.statName][0],v=a[e.statName][1],h=d3.scale.ordinal().range([p,v]),m=d3.svg.arc().outerRadius(o).innerRadius(c),f=d3.layout.pie().sort(null).value(function(t){return t.value}),g=d3.select(n).append("svg").attr("id",e.statName).attr("width",i).attr("height",l).append("g").attr("transform","translate("+i/2+","+l/2+")"),y=g.selectAll(".arc").data(f(e.details)).enter().append("g").attr("class","arc");y.append("path").attr("d",m).style("fill",function(t){return h(t.value)});var N=e.value;y.append("text").text(function(t){var e=marfeel.ChartController.getPercentage(N,t.value)+"%";return e+" "+t.value}).attr("transform",function(t,e){var a=this.getBBox(),r=a.width,n=0==e?i/2-r-s:-i/2+s;return"translate("+n+" , "+(d+20)+")"}).attr("dy",".35em"),y.append("text").text(function(t){return t.data.deviceName}).attr("font-weight","bold").attr("transform",function(t,e){var a=this.getBBox(),r=a.width,n=0==e?i/2-r-s:-i/2+s;return"translate("+n+" , "+d+")"}).attr("dy",".35em").attr("class","device-name").style("fill",function(t){return h(t.value)});var x=d,C=d3.scale.linear().domain([d3.min(e.history),d3.max(e.history)]).range([x,0]),w=d3.svg.area().x(function(t,a){return 2*o/e.history.length*a-o+u/2}).y0(x).y1(function(t){return C(t)}).interpolate("cardinal"),b=d3.svg.line().x(function(t,a){return 2*o/e.history.length*a-o+u/2}).y(function(t){return C(t)}).interpolate("cardinal"),g=d3.select("svg#"+e.statName).append("g").attr("transform","translate("+i/2+","+l/2+")").attr("class","center-group");g.append("clipPath").attr("id","circle-clip").append("ellipse").attr("cx",0).attr("cy",0).attr("rx",c-.06*d).attr("ry",c-.06*d).attr("fill","red"),g.append("path").attr("d",b(e.history)).attr("stroke",a[e.statName][1]).attr("stroke-width","4").attr("fill","none").attr("clip-path","url(#circle-clip)"),g.append("path").datum(e.history).attr("class","area").attr("d",w).attr("fill",a[e.statName][0]).attr("clip-path","url(#circle-clip)")},getPercentage:function(t,e){return 100*e/t}},window.addEventListener("load",function(){marfeel.ChartController.init()},!1);